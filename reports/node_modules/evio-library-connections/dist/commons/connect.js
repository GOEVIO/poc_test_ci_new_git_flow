"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DbConnection = void 0;
const manager_1 = require("./manager");
const logging_1 = require("../decorates/logging");
const retry_1 = require("../decorates/retry");
class DbConnection {
    constructor(host, dbName) {
        this._host = host;
        this._dbName = dbName;
    }
    async connect() {
        const baseManager = new manager_1.MongoDBConnectionManager(this._host, this._dbName);
        const loggingManager = new logging_1.LoggingDecorator(baseManager);
        const retryManager = new retry_1.RetryDecorator(loggingManager);
        try {
            const db = await retryManager.connect();
            return {
                db: db,
                close: async () => {
                    await retryManager.close();
                },
                checkConnections: () => {
                    retryManager.checkConnections();
                },
            };
        }
        catch (error) {
            console.error('Error connecting to MongoDB:', error);
        }
    }
    async close(db) {
        try {
            db.checkConnections();
            await db.close();
        }
        catch (error) {
            console.error('Error disconnecting to MongoDB:', error);
        }
    }
}
exports.DbConnection = DbConnection;
//# sourceMappingURL=connect.js.map