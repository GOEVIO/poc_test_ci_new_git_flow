"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureCountryCode = ensureCountryCode;
const retrieveCountryCode_1 = require("../decorates/retrieveCountryCode");
async function ensureCountryCode(charger, context) {
    try {
        if (charger.address?.countryCode) {
            console.log(`[${context}] countryCode already present: ${charger.address.countryCode}`);
            return charger;
        }
        const country = charger.country || charger.address?.country;
        if (!country) {
            console.warn(`[${context}] Missing 'country' field for charger.`);
            return charger;
        }
        const result = await (0, retrieveCountryCode_1.retrieveCountryCode)(country);
        if (result?.countryCode) {
            const { countryCode, countryName } = result;
            console.log(`[${context}] Retrieved countryCode: ${countryCode} for country: ${country}`);
            return {
                ...charger,
                address: {
                    ...charger.address,
                    country: countryName,
                    countryCode,
                },
            };
        }
        console.warn(`[${context}] No countryCode found for country: ${country}`);
        return charger;
    }
    catch (error) {
        console.error(`[${context}] Error ensuring countryCode:`, error.message);
        return charger;
    }
}
//# sourceMappingURL=ensureCountryCode.js.map